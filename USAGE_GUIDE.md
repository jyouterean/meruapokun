# メールくん 使い方ガイド

## 📧 基本的な使い方の流れ

### 1. ログイン

1. **ログイン画面**（`meruapokun.vercel.app`）にアクセス
2. **メールアドレス**を入力（例: `your@email.com`）
3. **「ログインリンクを送信」**ボタンをクリック
4. 入力したメールアドレスに**ログインリンク**が送信されます
5. メール内のリンクをクリックしてログイン

> **注意**: 初回ログイン時は、メール送信機能（SMTP）が正しく設定されている必要があります。

---

## 📋 ステップ1: リード（見込み客）の登録

### 方法A: CSVアップロード

1. **「リード」**メニューをクリック
2. **「CSVアップロード」**タブを選択
3. CSVファイルを選択（形式例）:
   ```csv
   email,companyName,contactName,position,industry,websiteUrl,memo,tags
   test@example.com,株式会社テスト,山田太郎,営業部長,IT,https://example.com,メモ,タグ1,タグ2
   ```
4. **「アップロード」**ボタンをクリック
5. 重複チェック後、リードが登録されます

### 方法B: テキスト貼り付け

1. **「リード」**メニューをクリック
2. **「テキスト貼り付け」**タブを選択
3. 1行1件でメールアドレスを入力:
   ```
   test1@example.com
   test2@example.com
   test3@example.com
   ```
4. **「登録」**ボタンをクリック

### リードの管理

- **ステータス**: `NEW`（新規）→ `CONTACTED`（連絡済み）→ `REPLIED`（返信あり）など
- **タグ付け**: リードにタグを追加して分類
- **メモ**: 各リードにメモを追加
- **検索**: メールアドレス、会社名、タグで検索可能

---

## 🎯 ステップ2: キャンペーンの作成

1. **「キャンペーン」**メニューをクリック
2. **「新規作成」**ボタンをクリック

### キャンペーン設定項目

#### 基本情報
- **キャンペーン名**: 例「2024年1月 新規開拓」
- **件名テンプレート**: `{{companyName}}様へのご提案`
- **本文テンプレート**: 
  ```
  {{contactName}}様
  
  いつもお世話になっております。
  {{companyName}}様向けに、{{industry}}業界向けのソリューションをご提案させていただきます。
  
  ...
  ```
- **送信元名**: `メールくん`
- **送信元メール**: `noreply@yourdomain.com`
- **署名**: メール末尾に自動付与

#### 送信設定
- **レート制限**: 
  - 1分あたり: `10通`（デフォルト）
  - 1日あたり: `50通`（デフォルト）
- **ランダムディレイ**: `20〜90秒`（デフォルト）
- **稼働時間帯**: `10:00〜18:00`（任意）
- **タイムゾーン**: `Asia/Tokyo`

#### AI生成オプション
- **AI生成を使用**: チェックを入れると、テンプレートではなくAIで文面を生成
- **AIプロンプト**: 生成時の指示（例: 「丁寧で簡潔な営業メール」）
- **トーン**: `professional`（プロフェッショナル）など
- **NGワード**: 使用を避ける単語を指定

3. **「保存」**ボタンをクリック

---

## 📤 ステップ3: キャンペーンの実行

### プレビュー確認

1. キャンペーン詳細ページで**「プレビュー」**をクリック
2. リード情報を差し込んだ結果を確認
3. 問題なければ次へ

### テスト送信

1. **「テスト送信」**ボタンをクリック
2. 自分のメールアドレスにテストメールが送信されます
3. 内容を確認して問題なければ本番開始

### キャンペーン開始

1. **「キャンペーン開始」**ボタンをクリック
2. 送信キューにリードが追加されます
3. **ワーカー**（GitHub Actions）が5分おきに自動で送信を実行

> **注意**: ワーカーが動作するには、GitHub Actionsの設定と環境変数（`CRON_SECRET`, `APP_URL`）が必要です。

### キャンペーンの停止

- **「キャンペーン停止」**ボタンでいつでも停止可能
- 停止後も送信済みメールの結果は確認できます

---

## 📊 ステップ4: 結果の確認

### ダッシュボード

1. **「ダッシュボード」**メニューをクリック
2. 全体のKPIを確認:
   - 総リード数
   - 送信数
   - 到達率
   - 開封率
   - クリック率
   - 返信率
   - バウンス率
   - 配信停止数

### キャンペーン詳細

1. キャンペーン一覧から**キャンペーン名**をクリック
2. キャンペーン別の詳細統計を確認

### リード別詳細

1. **「リード」**メニューからリードを選択
2. 送信履歴、イベント履歴、スレッドを確認

---

## 💬 ステップ5: 返信の管理

### 返信の確認

1. **「キャンペーン」**→ キャンペーン詳細 → **「返信一覧」**タブ
2. 返信が来たリードが一覧表示されます

### スレッド表示

1. **「スレッド」**メニューからスレッドを選択
2. 送受信の履歴が時系列で表示されます

### AI返信下書きの生成

1. スレッド詳細ページで**「AI返信下書きを生成」**ボタンをクリック
2. AIが返信案を生成します
3. 内容を確認・編集して**「送信」**ボタンをクリック

---

## ⚙️ ステップ6: 設定

### 送信プロバイダ設定

1. **「設定」**メニューをクリック
2. **「メール送信設定」**セクションで:
   - **プロバイダ**: `SendGrid` / `AWS SES` / `Gmail`
   - **APIキー** / **認証情報**を設定

### アプリ設定

- **会社名**: メールフッターに表示
- **会社住所**: メールフッターに表示（任意）
- **配信停止文言**: メール末尾に自動付与

---

## 🔧 高度な機能

### ワーカー（自動送信）の確認

1. **「管理」**→ **「メールキュー」**をクリック
2. 送信待ちメールの状況を確認:
   - `QUEUED`: 送信待ち
   - `SENDING`: 送信中
   - `SENT`: 送信完了
   - `FAILED`: 送信失敗
3. **「今すぐワーカー実行」**ボタンで手動実行も可能

### 監査ログ

- 全ての操作（送信、AI生成、設定変更など）が記録されます
- プロンプトも含めて保存されるため、再現性が担保されます

### 配信停止

- メール内の**配信停止リンク**をクリックすると自動で配信停止
- 停止後は、そのメールアドレスへの自動送信は行われません

---

## 🚨 トラブルシューティング

### ログインリンクが届かない

- **SMTP設定**を確認（`SMTP_HOST`, `SMTP_USER`, `SMTP_PASSWORD`）
- メールプロバイダの設定を確認
- スパムフォルダを確認

### メールが送信されない

1. **「管理」→「メールキュー」**でキュー状況を確認
2. `FAILED`の場合は`lastError`を確認
3. **SMTP設定**を確認
4. **GitHub Actions**のワーカーが動作しているか確認

### 返信が取り込まれない

1. **Webhook設定**を確認（SendGrid/SESのInbound Parse設定）
2. **「設定」**でWebhook URLを確認
3. SendGrid/SESのWebhook設定で、このURLを登録

---

## 📝 テンプレート変数

メールテンプレートで使用できる変数:

- `{{email}}`: メールアドレス
- `{{companyName}}`: 会社名
- `{{contactName}}`: 担当者名
- `{{position}}`: 役職
- `{{industry}}`: 業種
- `{{websiteUrl}}`: ウェブサイトURL

---

## 🔐 セキュリティ機能

- **レート制限**: 1分/1日の送信上限を設定
- **重複送信防止**: 同一リードに同一キャンペーンで再送しない
- **配信停止管理**: ワンタイムトークンで安全に処理
- **監査ログ**: 全ての操作を記録
- **NGワードフィルタ**: 誇大表現を自動フィルタ

---

## 📞 サポート

問題が発生した場合は、以下を確認してください:

1. **環境変数**が正しく設定されているか（`VERCEL_ENV_VARIABLES.md`を参照）
2. **データベース接続**が正常か
3. **メールプロバイダ**の設定が正しいか
4. **GitHub Actions**のワーカーが動作しているか

---

以上が基本的な使い方です。詳細は各画面のヘルプを参照してください。

